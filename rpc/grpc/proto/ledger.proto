syntax = "proto3";
package proto;

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "types/basic.proto";
import "common.proto";

option go_package = ".;proto";

service LedgerAPI{
    rpc AccountBlocksCount(types.Address) returns (Int64){
        option (google.api.http) = {
           get: "/ledger/accountBlocksCount"
       };
    }

    rpc AccountHistoryTopn(AccountHistoryTopnRequest) returns (APIBlocks){
        option (google.api.http) = {
           get: "/ledger/accountHistoryTopn"
       };
    }

    rpc AccountInfo(types.Address) returns (APIAccount){
        option (google.api.http) = {
           get: "/ledger/accountInfo"
       };
    }

    rpc ConfirmedAccountInfo(types.Address) returns (APIAccount){
        option (google.api.http) = {
           get: "/ledger/confirmedAccountInfo"
       };
    }

    rpc AccountRepresentative(types.Address) returns (types.Address){
        option (google.api.http) = {
           get: "/ledger/accountRepresentative"
       };
    }

    rpc AccountVotingWeight(types.Address) returns (types.Balance){
        option (google.api.http) = {
           get: "/ledger/accountVotingWeight"
       };
    }

    rpc AccountsBalance(types.Addresses) returns (AccountsBalanceResponse){
        option (google.api.http) = {
           get: "/ledger/accountsBalance"
       };
    }

    rpc AccountsFrontiers(types.Addresses) returns (AccountsFrontiersResponse){
        option (google.api.http) = {
           get: "/ledger/accountsFrontiers"
       };
    }

    rpc AccountsPending(AccountsPendingRequest) returns (AccountsPendingResponse){
        option (google.api.http) = {
           get: "/ledger/accountsPending"
       };
    }

    rpc AccountsCount(google.protobuf.Empty) returns (UInt64){
        option (google.api.http) = {
           get: "/ledger/accountsCount"
       };
    }

    rpc Accounts(Offset) returns (types.Addresses){
        option (google.api.http) = {
           get: "/ledger/accounts"
       };
    }

    rpc BlockAccount(types.Hash) returns (types.Address){
        option (google.api.http) = {
           get: "/ledger/blockAccount"
       };
    }

    rpc BlockConfirmedStatus(types.Hash) returns (Boolean){
        option (google.api.http) = {
           get: "/ledger/blockConfirmedStatus"
       };
    }

    rpc BlockHash(types.StateBlock) returns (types.Hash){
        option (google.api.http) = {
           get: "/ledger/blockHash"
       };
    }

    rpc BlocksCount(google.protobuf.Empty) returns (BlocksCountResponse){
        option (google.api.http) = {
           get: "/ledger/blocksCount"
       };
    }

    rpc BlocksCount2(google.protobuf.Empty) returns (BlocksCountResponse){
        option (google.api.http) = {
           get: "/ledger/blocksCount2"
       };
    }

    rpc BlocksCountByType(google.protobuf.Empty) returns (BlocksCountResponse){
        option (google.api.http) = {
           get: "/ledger/blocksCountByType"
       };
    }

    rpc BlocksInfo(types.Hashes) returns (APIBlocks){
        option (google.api.http) = {
           get: "/ledger/blocksInfo"
       };
    }

    rpc ConfirmedBlocksInfo(types.Hashes) returns (APIBlocks){
        option (google.api.http) = {
           get: "/ledger/confirmedBlocksInfo"
       };
    }

    rpc Blocks(Offset) returns (APIBlocks){
        option (google.api.http) = {
           get: "/ledger/blocks"
       };
    }

    rpc Chain(ChainRequest) returns (types.Hashes){
        option (google.api.http) = {
           get: "/ledger/chain"
       };
    }

    rpc Delegators(types.Address) returns (APIAccountBalances){
        option (google.api.http) = {
           get: "/ledger/delegators"
       };
    }

    rpc DelegatorsCount(types.Address) returns (Int64){
        option (google.api.http) = {
           get: "/ledger/delegatorsCount"
       };
    }

    rpc Pendings(google.protobuf.Empty) returns (APIPendings){
        option (google.api.http) = {
           get: "/ledger/pendings"
       };
    }

    rpc Representatives(Boolean) returns (APIRepresentatives){
        option (google.api.http) = {
           get: "/ledger/representatives"
       };
    }

    rpc Tokens(google.protobuf.Empty) returns (types.TokenInfos){
        option (google.api.http) = {
           get: "/ledger/tokens"
       };
    }

    rpc TransactionsCount(google.protobuf.Empty) returns (BlocksCountResponse){
        option (google.api.http) = {
           get: "/ledger/transactionsCount"
       };
    }

    rpc TokenInfoById(types.Hash) returns (types.TokenInfo){
        option (google.api.http) = {
           get: "/ledger/tokenInfoById"
       };
    }

    rpc TokenInfoByName(String) returns (types.TokenInfo){
        option (google.api.http) = {
           get: "/ledger/tokenInfoByName"
       };
    }

    rpc GetAccountOnlineBlock(types.Address) returns (types.StateBlock){
        option (google.api.http) = {
           get: "/ledger/getAccountOnlineBlock"
       };
    }

    rpc GenesisAddress(google.protobuf.Empty) returns (types.Address){
        option (google.api.http) = {
           get: "/ledger/genesisAddress"
       };
    }

    rpc GasAddress(google.protobuf.Empty) returns (types.Address){
        option (google.api.http) = {
           get: "/ledger/gasAddress"
       };
    }

    rpc ChainToken(google.protobuf.Empty) returns (types.Hash){
        option (google.api.http) = {
           get: "/ledger/chainToken"
       };
    }

    rpc GasToken(google.protobuf.Empty) returns (types.Hash){
        option (google.api.http) = {
           get: "/ledger/gasToken"
       };
    }

    rpc GenesisMintageBlock(google.protobuf.Empty) returns (types.StateBlock){
        option (google.api.http) = {
           get: "/ledger/genesisMintageBlock"
       };
    }

    rpc GenesisMintageHash(google.protobuf.Empty) returns (types.Hash){
        option (google.api.http) = {
           get: "/ledger/genesisMintageHash"
       };
    }

    rpc GenesisBlock(google.protobuf.Empty) returns (types.StateBlock){
        option (google.api.http) = {
           get: "/ledger/genesisBlock"
       };
    }

    rpc GenesisBlockHash(google.protobuf.Empty) returns (types.Hash){
        option (google.api.http) = {
           get: "/ledger/genesisBlockHash"
       };
    }

    rpc GasBlockHash(google.protobuf.Empty) returns (types.Hash){
        option (google.api.http) = {
           get: "/ledger/gasBlockHash"
       };
    }

    rpc GasMintageBlock(google.protobuf.Empty) returns (types.StateBlock){
        option (google.api.http) = {
           get: "/ledger/gasMintageBlock"
       };
    }

    rpc GasBlock(google.protobuf.Empty) returns (types.StateBlock){
        option (google.api.http) = {
           get: "/ledger/gasBlock"
       };
    }

    rpc IsGenesisBlock(types.StateBlock) returns (Boolean){
        option (google.api.http) = {
           get: "/ledger/isGenesisBlock"
       };
    }

    rpc IsGenesisToken(types.StateBlock) returns (Boolean){
        option (google.api.http) = {
           get: "/ledger/isGenesisToken"
       };
    }

    rpc AllGenesisBlocks(types.StateBlock) returns (types.StateBlocks){
        option (google.api.http) = {
           get: "/ledger/allGenesisBlocks"
       };
    }

    rpc GenerateSendBlock(GenerateSendBlockRequest) returns (types.StateBlocks){
        option (google.api.http) = {
           post: "/ledger/generateSendBlock"
           body: "*"
       };
    }

    rpc GenerateReceiveBlock(GenerateReceiveBlockRequest) returns (types.StateBlocks){
        option (google.api.http) = {
           post: "/ledger/generateReceiveBlock"
           body: "*"
       };
    }

    rpc GenerateReceiveBlockByHash(GenerateReceiveBlockByHashRequest) returns (types.StateBlocks){
        option (google.api.http) = {
           post: "/ledger/generateReceiveBlockByHash"
           body: "*"
       };
    }

    rpc GenerateChangeBlock(GenerateChangeBlockRequest) returns (types.StateBlocks){
        option (google.api.http) = {
           post: "/ledger/generateChangeBlock"
           body: "*"
       };
    }

    rpc Process(types.StateBlock) returns (types.Hash){
        option (google.api.http) = {
           post: "/ledger/process"
           body: "*"
       };
    }

    rpc NewBlock(google.protobuf.Empty) returns (stream APIBlock){
        option (google.api.http) = {
           post: "/ledger/newBlock"
           body: "*"
       };
    }

    rpc NewAccountBlock(types.Address) returns (stream APIBlock){
        option (google.api.http) = {
           post: "/ledger/newAccountBlock"
           body: "*"
       };
    }

    rpc BalanceChange(types.Address) returns (stream APIAccount){
        option (google.api.http) = {
           post: "/ledger/balanceChange"
           body: "*"
       };
    }

    rpc NewPending(types.Address) returns (stream APIPending){
        option (google.api.http) = {
           post: "/ledger/newPending"
           body: "*"
       };
    }

    rpc Test(google.protobuf.Empty) returns (TestResponse){
        option (google.api.http) = {
           post: "/ledger/test"
           body: "*"
       };
    }

}

message TestResponse {
    string version = 1;
}

message AccountHistoryTopnRequest {
    string    hash    = 1;
    int32     count   = 2;
}

message AccountsPendingRequest {
    types.Addresses  addresses = 1;
    int32      count     = 2;
}

message ChainRequest {
    types.Addresses  addresses = 1;
    int32      count     = 2;
}

message AccountsBalanceResponse{
    message APIAccountsBalance  {
	    int64  Balance  = 1;
        int64  Vote     = 2;
        int64  Network  = 3;
        int64  Storage  = 4;
        int64  Oracle   = 5;
        int64  Pending  = 6;
    }
    message balances {
        map<string, APIAccountsBalance> balances = 1;
    }
    map<string, balances> accountsBalances = 1;
}

message AccountsFrontiersResponse{
    message frontier{
        map<string, string> frontier = 1;
    }
    map<string, frontier> accountsFrontiers = 1;
}

message AccountsPendingResponse{
    map<string, APIPendings> accountsPendings = 1;
}

message BlocksCountResponse{
    map<string, uint64> count = 1;
}

// generate block

message APISendBlockPara  {
    string  From      = 1;
    string  TokenName = 2;
    string  To        = 3;
    int64   Amount    = 4;
    string  Sender    = 5;
    string  Receiver  = 6;
    string  Message   = 7;
}

message GenerateSendBlockRequest {
    APISendBlockPara para    = 1;
    string           prkStr  = 2;
}

message GenerateReceiveBlockRequest {
    types.StateBlock block   = 1;
    string     prkStr  = 2;
}

message GenerateReceiveBlockByHashRequest {
    string    hash   = 1;
    string    prkStr  = 2;
}

message GenerateChangeBlockRequest {
    string    account          = 1;
    string    representative   = 2;
    string    prkStr           = 3;
}

// common type

message APIBlock {
    types.StateBlock block  = 1;
    string tokenName  = 2;
    int64  amount     = 3;
    string hash       = 4;

    uint64 povConfirmHeight = 5;
    uint64 povConfirmCount  = 6;
}

message APIBlocks {
    repeated APIBlock blocks = 1;
}

message APITokenMeta {
    types.TokenMeta tokenMeta = 1;
    string    tokenName = 2;
    int64     pending   = 3;
}

message APIAccount  {
    string address          = 1;
    int64  coinBalance      = 2;
    int64  coinVote         = 3;
    int64  coinNetwork      = 4;
    int64  coinStorage      = 5;
    int64  coinOracle       = 6;
    int64  representative   = 7;
    repeated  APITokenMeta tokens   = 8;
}

message APIAccountBalances {
    message APIAccountBalance {
        string Address = 1;
        int64  Balance = 2;
    }
    repeated APIAccountBalance balances = 1;
}

message APIPending {
    types.PendingKey    key   = 1;
    types.PendingInfo   info  = 2;
    string  TokenName  = 3;
    int64   Timestamp  = 4;
    bytes   BlockType  = 5;
}

message APIPendings {
    repeated APIPending pendings = 1;
}

message APIRepresentative {
    string Address   = 1;
    int64  Balance   = 2;
    int64  Vote      = 3;
    int64  Network   = 4;
    int64  Storage   = 5;
    int64  Oracle    = 6;
    int64  Total     = 7;
}

message APIRepresentatives {
    repeated APIRepresentative representatives = 1;
}